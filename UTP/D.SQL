SELECT
--SUBSTR( substr(trim(Header.SEGMENT1),4) ,INSTR(substr(trim(Header.SEGMENT1),4),'-')+1 ) AS OrderNumberTrim,--De la posicion 4 en adelante
Header.SEGMENT1 AS OrderNumberTrim, --De la posicion 4 hasta la posicion 9
SYSDATE AS ElaborationDate,
Header.PO_HEADER_ID AS PoHeadaerId,
Header.SEGMENT1 AS Segment1,
PO_BIP_HELPER.get_doc_revision_number(Version.CHANGE_ORDER_TYPE, Version.co_sequence, Header.po_header_id, Version.REVISION_NUM) AS RevisionNum,
Header.SIGNATURE_REQUIRED_FLAG as SignatureRequiredFlag,
PozSupplierSite.CUSTOMER_NUM AS CustomerNum,
Header.VENDOR_ORDER_NUM AS VendorOrderNum,
Supplier.SEGMENT1 AS SupplierNumber,
ZXR.REGISTRATION_NUMBER AS Nit,--NIT
DocStyle.DISPLAY_NAME AS DocumentStyle,
SoldToLeRegistration.REGISTRATION_NUMBER AS TaxRegistrationNumber,
NVL(Version.CO_NUM,0) AS CoNum,
Version.CHANGE_ORDER_DESC AS ChangeOrderDesc,
Header.ACCEPTANCE_REQUIRED_FLAG AS AcceptanceRequiredFlag,
Header.ACCEPTANCE_DUE_DATE AS AcceptanceDueDate,
CarrierPartyName.PARTY_NAME AS PartyName2,
FobPoLookupPEO.MEANING AS DisplayedField3,
FreightTermsPoLookupPEO.MEANING AS DisplayedField2,
PaymentTermsHeader.NAME AS Name3,
Header.PAY_ON_CODE AS PayOnCode,
NegotiationTerms.BODY AS Body,
NegotiationTerms.ENABLED_FLAG AS TermsAndConditionsEnabledFlag,
PersonName.DISPLAY_NAME AS DisplayName1,
PersonEmailAddress.EMAIL_ADDRESS AS EmailAddress1,
PersonPhone.DISPLAY_PHONE_NUMBER AS DisplayPhoneNumber,
PersonFaxPhone.DISPLAY_PHONE_NUMBER AS DisplayPhoneNumber1,
SupplierContactPartyName.PARTY_NAME AS PartyName1,
PO_BIP_HELPER.get_supplier_contact_info(Header.VENDOR_CONTACT_ID,'EMAIL',null) AS SupplierContactEmailAddress,
SoldToLe.NAME AS SoldToLeName,
SoldToLeLocation.ADDRESS1 AS SoldToLeAddressLine1 ,
SoldToLeLocation.ADDRESS2 AS SoldToLeAddressLine2 ,
SoldToLeLocation.ADDRESS3 AS SoldToLeAddressLine3 ,
SoldToLeLocation.ADDRESS4 AS SoldToLeAddressLine4,
SoldToLeLocation.CITY AS SoldToLeTownOrCity,
SoldToLeLocation.COUNTY AS SoldToLeRegion1,
SoldToLeLocation.STATE AS SoldToLeRegion2,
SoldToLeLocation.COUNTRY AS SoldToLeCountry,
SoldToLeLocation.POSTAL_CODE AS SoldToLePostalCode ,
BillToLoc.LOCATION_NAME AS BillToLocationName,
BillToLoc.ADDRESS_LINE_1 AS BillToLocAddressLine1,
BillToLoc.ADDRESS_LINE_2 AS BillToLocAddressLine2,
BillToLoc.ADDRESS_LINE_3 AS BillToLocAddressLine3,
BillToLoc.ADDRESS_LINE_4 AS BillToLocAddressLine4,
BillToLoc.BUILDING AS BillToLocBuilding ,
BillToLoc.FLOOR_NUMBER AS BillToLocFloorNumber,
BillToLoc.TOWN_OR_CITY AS BillToLocTownOrCity,
BillToLoc.REGION_1 AS BillToLocRegion1 ,
BillToLoc.REGION_2 AS BillToLocRegion2 ,
BillToLoc.REGION_3 AS BillToLocRegion3,
BillToLoc.COUNTRY AS BillToLocCountry ,
BillToLoc.POSTAL_CODE AS BillToLocPostalCode ,
BillToLoc.LONG_POSTAL_CODE AS BillToLocLongPostalCode ,
BillToLoc.LOC_INFORMATION13 AS BillToLocAddlAddressAttribute1 ,
BillToLoc.LOC_INFORMATION14 AS BillToLocAddlAddressAttribute2 ,
BillToLoc.LOC_INFORMATION15 AS BillToLocAddlAddressAttribute3 ,
BillToLoc.LOC_INFORMATION16 AS BillToLocAddlAddressAttribute4 ,
BillToLoc.LOC_INFORMATION17 AS BillToLocAddlAddressAttribute5,
ShipToLoc.LOCATION_NAME AS ShipToLocationName,
ShipToLoc.ADDRESS_LINE_1 AS ShipToLocAddressLine1 ,
ShipToLoc.ADDRESS_LINE_2 AS ShipToLocAddressLine2 ,
ShipToLoc.ADDRESS_LINE_3 AS ShipToLocAddressLine3 ,
ShipToLoc.ADDRESS_LINE_4 AS ShipToLocAddressLine4 ,
ShipToLoc.BUILDING AS ShipToLocBuilding,
ShipToLoc.FLOOR_NUMBER AS ShipToLocFloorNumber,
ShipToLoc.TOWN_OR_CITY AS ShipToLocTownOrCity,
ShipToLoc.REGION_1 AS ShipToLocRegion1 ,
ShipToLoc.REGION_2 AS ShipToLocRegion2 ,
ShipToLoc.REGION_3 AS ShipToLocRegion3,
ShipToLoc.COUNTRY AS ShipToLocCountry,
ShipToLoc.POSTAL_CODE AS ShipToLocPostalCode,
ShipToLoc.LONG_POSTAL_CODE AS ShipToLocLongPostalCode,
ShipToLoc.LOC_INFORMATION13 AS ShipToLocAddlAddressAttribute1 ,
ShipToLoc.LOC_INFORMATION14 AS ShipToLocAddlAddressAttribute2 ,
ShipToLoc.LOC_INFORMATION15 AS ShipToLocAddlAddressAttribute3 ,
ShipToLoc.LOC_INFORMATION16 AS ShipToLocAddlAddressAttribute4 ,
ShipToLoc.LOC_INFORMATION17 AS ShipToLocAddlAddressAttribute5 ,
SupplierPartyName.PARTY_NAME AS SupplierPartyName,
SupplierLocation.ADDRESS1 AS SupplierSiteAddress1 ,
SupplierLocation.ADDRESS2 AS SupplierSiteAddress2 ,
SupplierLocation.ADDRESS3 AS SupplierSiteAddress3 ,
SupplierLocation.ADDRESS4 AS SupplierSiteAddress4 ,
SupplierLocation.BUILDING AS SupplierSiteBuilding,
SupplierLocation.FLOOR_NUMBER AS SupplierSiteFloorNumber,
SupplierLocation.CITY AS SupplierSiteCity ,
SupplierLocation.COUNTY AS SupplierSiteCounty,
SupplierLocation.PROVINCE AS SupplierSiteProvince ,
SupplierLocation.STATE AS SupplierSiteState ,
SupplierLocation.COUNTRY AS SupplierSiteCountry ,
SupplierLocation.POSTAL_CODE AS SupplierSitePostalCode ,
SupplierLocation.POSTAL_PLUS4_CODE AS SupplierSitePostalPlus4Code,
SupplierLocation.ADDR_ELEMENT_ATTRIBUTE1 AS SuppSiteAddrElementAttribute1 ,
SupplierLocation.ADDR_ELEMENT_ATTRIBUTE2 AS SuppSiteAddrElementAttribute2 ,
SupplierLocation.ADDR_ELEMENT_ATTRIBUTE3 AS SuppSiteAddrElementAttribute3 ,
SupplierLocation.ADDR_ELEMENT_ATTRIBUTE4 AS SuppSiteAddrElementAttribute4 ,
SupplierLocation.ADDR_ELEMENT_ATTRIBUTE5 AS SuppSiteAddrElementAttribute5,
Header.TYPE_LOOKUP_CODE AS TypeLookupCode,
Version.CHANGE_ORDER_STATUS AS ChangeOrderStatus,
Header.CURRENCY_CODE AS CurrencyCode,
Currency.NAME AS Name4,
Header.CANCEL_FLAG AS CancelFlag,
Version.CO_CANCELED_FLAG AS CoCanceledFlag,
Header.CONFIRMING_ORDER_FLAG AS ConfirmingOrderFlag,
Header.CONTERMS_EXIST_FLAG AS ContermsExistFlag,
Header.DOCUMENT_CREATION_METHOD AS DocumentCreationMethod,
Header.CREATION_DATE AS CreationDate,
Header.COMMENTS AS Comments,
Header.NOTE_TO_AUTHORIZER AS NoteToAuthorizer , 
Header.NOTE_TO_RECEIVER AS NoteToReceiver ,     
Header.NOTE_TO_VENDOR AS NoteToVendor,          
Header.ATTRIBUTE_CATEGORY AS AttributeCategory,
Header.ATTRIBUTE1 AS Attribute1          ,
Header.ATTRIBUTE2 AS Attribute2      ,
Header.ATTRIBUTE3 AS Attribute3      ,
Header.ATTRIBUTE4 AS Attribute4      ,
Header.ATTRIBUTE5 AS Attribute5      ,
Header.ATTRIBUTE6 AS Attribute6      ,
Header.ATTRIBUTE7 AS Attribute7      ,
Header.ATTRIBUTE8 AS Attribute8      ,
Header.ATTRIBUTE9 AS Attribute9   ,
Header.ATTRIBUTE10 AS Attribute10    ,
Header.ATTRIBUTE11 AS Attribute11    ,
Header.ATTRIBUTE12 AS Attribute12    ,
Header.ATTRIBUTE13 AS Attribute13    ,
Header.ATTRIBUTE14 AS Attribute14    ,
Header.ATTRIBUTE15 AS Attribute15    ,
Header.ATTRIBUTE16 AS Attribute16 ,
Header.ATTRIBUTE17 AS Attribute17 ,
Header.ATTRIBUTE18 AS Attribute18 ,
Header.ATTRIBUTE19 AS Attribute19 ,
Header.ATTRIBUTE20 AS Attribute20 ,
Header.ATTRIBUTE_DATE1 AS AttributeDate1 ,
Header.ATTRIBUTE_DATE2 AS AttributeDate2 ,
Header.ATTRIBUTE_DATE3 AS AttributeDate3 ,
Header.ATTRIBUTE_DATE4 AS AttributeDate4 ,
Header.ATTRIBUTE_DATE5 AS AttributeDate5 ,
Header.ATTRIBUTE_DATE6 AS AttributeDate6 ,
Header.ATTRIBUTE_DATE7 AS AttributeDate7 ,
Header.ATTRIBUTE_DATE8 AS AttributeDate8 ,
Header.ATTRIBUTE_DATE9 AS AttributeDate9 ,
Header.ATTRIBUTE_DATE10 AS AttributeDate10,
Header.ATTRIBUTE_TIMESTAMP1 AS AttributeTimestamp1 ,
Header.ATTRIBUTE_TIMESTAMP2 AS AttributeTimestamp2 ,
Header.ATTRIBUTE_TIMESTAMP3 AS AttributeTimestamp3 ,
Header.ATTRIBUTE_TIMESTAMP4 AS AttributeTimestamp4 ,
Header.ATTRIBUTE_TIMESTAMP5 AS AttributeTimestamp5 ,
Header.ATTRIBUTE_TIMESTAMP6 AS AttributeTimestamp6 ,
Header.ATTRIBUTE_TIMESTAMP7 AS AttributeTimestamp7 ,
Header.ATTRIBUTE_TIMESTAMP8 AS AttributeTimestamp8 ,
Header.ATTRIBUTE_TIMESTAMP9 AS AttributeTimestamp9 ,
Header.ATTRIBUTE_TIMESTAMP10 AS AttributeTimestamp10,
Header.ATTRIBUTE_NUMBER1 AS AttributeNumber1,
Header.ATTRIBUTE_NUMBER2 AS AttributeNumber2 ,
Header.ATTRIBUTE_NUMBER3 AS AttributeNumber3 ,
Header.ATTRIBUTE_NUMBER4 AS AttributeNumber4 ,
Header.ATTRIBUTE_NUMBER5 AS AttributeNumber5 ,
Header.ATTRIBUTE_NUMBER6 AS AttributeNumber6 ,
Header.ATTRIBUTE_NUMBER7 AS AttributeNumber7 ,
Header.ATTRIBUTE_NUMBER8 AS AttributeNumber8 ,
Header.ATTRIBUTE_NUMBER9 AS AttributeNumber9 ,
Header.ATTRIBUTE_NUMBER10 AS AttributeNumber10 ,
Header.GLOBAL_ATTRIBUTE_CATEGORY AS GlobalAttributeCategory  ,
Header.GLOBAL_ATTRIBUTE1 AS GlobalAttribute1     ,
Header.GLOBAL_ATTRIBUTE2 AS GlobalAttribute2     ,
Header.GLOBAL_ATTRIBUTE3 AS GlobalAttribute3     ,
Header.GLOBAL_ATTRIBUTE4 AS GlobalAttribute4     ,
Header.GLOBAL_ATTRIBUTE5 AS GlobalAttribute5     ,
Header.GLOBAL_ATTRIBUTE6 AS GlobalAttribute6     ,
Header.GLOBAL_ATTRIBUTE7 AS GlobalAttribute7     ,
Header.GLOBAL_ATTRIBUTE8 AS GlobalAttribute8     ,
Header.GLOBAL_ATTRIBUTE9 AS GlobalAttribute9     ,
Header.GLOBAL_ATTRIBUTE10 AS GlobalAttribute10   ,
Header.GLOBAL_ATTRIBUTE11 AS GlobalAttribute11   ,
Header.GLOBAL_ATTRIBUTE12 AS GlobalAttribute12   ,
Header.GLOBAL_ATTRIBUTE13 AS GlobalAttribute13   ,
Header.GLOBAL_ATTRIBUTE14 AS GlobalAttribute14   ,
Header.GLOBAL_ATTRIBUTE15 AS GlobalAttribute15   ,
Header.GLOBAL_ATTRIBUTE16 AS GlobalAttribute16   ,
Header.GLOBAL_ATTRIBUTE17 AS GlobalAttribute17   ,
Header.GLOBAL_ATTRIBUTE18 AS GlobalAttribute18   ,
Header.GLOBAL_ATTRIBUTE19 AS GlobalAttribute19   ,
Header.GLOBAL_ATTRIBUTE20 AS GlobalAttribute20   ,
Header.BUYER_MANAGED_TRANSPORT_FLAG As BuyerManagedTransportation,
Header.ENTITY_CHANGE_TYPE_CODE As "EntityChangeTypeCode",
BillToBu.NAME AS BillToBuName,
Version.CO_SEQUENCE As HeaderCoSequence,
PurchasingDocumentStyleHeade1.CONSIGNED_ITEMS_FLAG As IsOrderConsigned,
AdditionalPartyNamePEO.PARTY_NAME AS SupplierAlternateName,
PO_BIP_HELPER.get_ordered_display(Header.PO_HEADER_ID,'0','DRAFT','H',Header.CURRENCY_CODE) AS OrderedDisplay,
PO_BIP_HELPER.get_ordered_display(Header.PO_HEADER_ID,'0','TXN','H',Header.CURRENCY_CODE) AS OriginalOrderedAmountDisplay,
PO_BIP_HELPER.get_global_attr('AMOUNT_CHANGE_DISPLAY') AS AmountChangeDisplay,
PO_BIP_HELPER.get_total_tax(Header.PO_HEADER_ID,'HEADER') AS TotalTaxDisplay,
PO_BIP_HELPER.get_global_attr('RECOVERABLEINCLUSIVETAX_DISPLAY') AS RecoverableInclusiveTaxDisplay,
PO_BIP_HELPER.get_global_attr('NONRECOVERABLEINCLUSIVETAX_DISPLAY') AS NonRecoverableInclTaxDisplay,
PO_BIP_HELPER.get_supplier_contact_info(Header.VENDOR_CONTACT_ID,'PHONE','FAX') AS SupplierContactFax,
PO_BIP_HELPER.get_supplier_contact_info(Header.VENDOR_CONTACT_ID,'PHONE','GEN') AS SupplierContactPhone,
PO_BIP_HELPER.get_requester_name(Header.PO_HEADER_ID,null,'DRAFT',Version.CO_SEQUENCE) as HdrRequester,
PO_BIP_HELPER.get_person_contact_info(NULL,'PHONE',NULL) AS RequesterPhoneNumber,
PO_BIP_HELPER.get_person_contact_info(NULL,'FAX',NULL) AS RequesterFaxNumber,
PO_BIP_HELPER.get_soldto_le_add(SoldToLeLocation.LOCATION_ID)AS SoldToLeAddress,
null as SoldToLeRegion3,
PO_BIP_HELPER.get_state_province(SoldToLeLocation.COUNTRY, SoldToLeLocation.COUNTY, SoldToLeLocation.STATE, null, null) as SoldToLeStateProvn,
PO_BIP_HELPER.get_formatted_address(BillToLoc.ADDRESS_LINE_1,BillToLoc.ADDRESS_LINE_2,BillToLoc.ADDRESS_LINE_3,BillToLoc.ADDRESS_LINE_4,BillToLoc.TOWN_OR_CITY,BillToLoc.POSTAL_CODE,
BillToLoc.REGION_1,BillToLoc.REGION_2,BillToLoc.REGION_3,BillToLoc.FLOOR_NUMBER,BillToLoc.BUILDING,BillToLoc.COUNTRY,BillToLoc.LOC_INFORMATION13,
BillToLoc.LOC_INFORMATION14,BillToLoc.LOC_INFORMATION15,BillToLoc.LOC_INFORMATION16,BillToLoc.LOC_INFORMATION17,'N') as BillToAddress,
PO_BIP_HELPER.get_formatted_address(ShipToLoc.ADDRESS_LINE_1,ShipToLoc.ADDRESS_LINE_2,ShipToLoc.ADDRESS_LINE_3,ShipToLoc.ADDRESS_LINE_4,ShipToLoc.TOWN_OR_CITY,ShipToLoc.POSTAL_CODE,
ShipToLoc.REGION_1,ShipToLoc.REGION_2,ShipToLoc.REGION_3,ShipToLoc.FLOOR_NUMBER,ShipToLoc.BUILDING,ShipToLoc.COUNTRY,ShipToLoc.LOC_INFORMATION13,
ShipToLoc.LOC_INFORMATION14,ShipToLoc.LOC_INFORMATION15,ShipToLoc.LOC_INFORMATION16,ShipToLoc.LOC_INFORMATION17,'N') as ShipToAddress,
PO_BIP_HELPER.get_formatted_supplier_address(SupplierLocation.LOCATION_ID) as SupplierAddress,
PO_BIP_HELPER.get_global_attr('LINE1') AS RequesterAddressLine1,
PO_BIP_HELPER.get_global_attr('LINE2') AS RequesterAddressLine2,
PO_BIP_HELPER.get_global_attr('LINE3') AS RequesterAddressLine3,
PO_BIP_HELPER.get_global_attr('LINE4') AS RequesterAddressLine4,
PO_BIP_HELPER.get_global_attr('BUILDING') AS RequesterAddressBuilding,
PO_BIP_HELPER.get_global_attr('FLOORNUMBER') AS RequesterAddressFloorNumber,
PO_BIP_HELPER.get_global_attr('TOWNORCITY') AS RequesterAddressTownOrCity,
PO_BIP_HELPER.get_global_attr('REGION1') AS RequesterAddressRegion1,
PO_BIP_HELPER.get_global_attr('REGION2') AS RequesterAddressRegion2,
PO_BIP_HELPER.get_global_attr('REGION3') AS RequesterAddressRegion3,
PO_BIP_HELPER.get_global_attr('COUNTRY') AS RequesterAddressCountry,
PO_BIP_HELPER.get_global_attr('POSTALCODE') AS RequesterAddressPostalCode,
PO_BIP_HELPER.get_global_attr('LONGPOSTALCODE') AS RequesterAddressLongPostalCode,
PO_BIP_HELPER.get_global_attr('ADDLATTR3') AS RequesterAddlAddressAttr1,
PO_BIP_HELPER.get_global_attr('ADDLATTR2') AS RequesterAddlAddressAttr2,
PO_BIP_HELPER.get_global_attr('ADDLATTR3') AS RequesterAddlAddressAttr3,
PO_BIP_HELPER.get_global_attr('ADDLATTR4') AS RequesterAddlAddressAttr4,
PO_BIP_HELPER.get_global_attr('ADDLATTR5') AS RequesterAddlAddressAttr5,
TO_CHAR(FirstVersion.DOCUMENT_DATE,'DD-MON-YYYY') As OrderDateDisplay,
TO_CHAR(Version.DOCUMENT_DATE,'DD-MON-YYYY') As ChangeOrderDateDisplay,
TO_CHAR(Version.CREATION_DATE,'DD-MON-YYYY') As VersionDateDisplay,
PurchasingSystemParameterPEO.INVENTORY_ORGANIZATION_ID as Definvorgid,
DECODE(Header.CANCEL_FLAG,'Y','CANCELLED',DECODE(Header.ENTITY_CHANGE_TYPE_CODE,'I','NEW','U','CHANGED','C','CHANGED',NULL)) AS HeaderStatus,
'POZ_SUPPLIER_SITES_ALL_M' AS AttachEntityNameSuppSite,
PO_BIP_HELPER.get_shipping_method(CarrierPartyName.PARTY_NAME,ModeOfTransportLookupPEO.MEANING,ServiceLevelLookupPEO.MEANING) AS ShippingMethod,
PO_BIP_HELPER.get_state_province(BillToLoc.COUNTRY,BillToLoc.REGION_1,BillToLoc.REGION_2,BillToLoc.REGION_3,BillToLoc.LOC_INFORMATION16) AS BillToLocStateProvn,
PO_BIP_HELPER.get_region(BillToLoc.COUNTRY,BillToLoc.REGION_1,BillToLoc.REGION_2) AS BillToLocRegion,
PO_BIP_HELPER.get_county(BillToLoc.COUNTRY,BillToLoc.REGION_1) AS BillToLocCounty,
PurchasingSystemParameterPEO.MAX_LINES_ON_PDF as MaxLinesInPdf,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTOMERNAME') AS HdrShipToCustomerName,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCONTACTNAME') AS HdrShiptoCustContactName,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCONTACTEMAILADDRESS') AS HdrShipToCustConEmailAddress,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCONTACTPHONENUMBER') AS HdrShipToCustConPhoneNumber,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCONTACTPHONETYPE') AS HdrShipToCustContactPhoneType,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCONTACTPREFERREDCONTACTMETHOD') AS HdrShiptoCustPrefMethod,
PO_BIP_HELPER.get_ship_to_cust_address AS HdrShiptoCustAddress,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTFLOORNUMBER') AS ShipToCustFloorNumber,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTBUILDING') AS ShipToCustBuilding,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCITY') AS ShipToCustCity,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTPROVINCE') AS ShipToCustProvince,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCOUNTY') AS ShipToCustCounty,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTSTATE') AS ShipToCustState,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTCOUNTRY') AS ShipToCustCountry,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTPOSTALCODE') AS ShipToCustPostalCode,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTPOSTALPLUS4CODE') AS ShipToCustPostalPlus4Code,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRESS1') AS ShipToCustAddress1,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRESS2') AS ShipToCustAddress2,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRESS3') AS ShipToCustAddress3,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRESS4') AS ShipToCustAddress4,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRELEMENTATTRIBUTE1') AS ShipToCustAddrElementAtt1,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRELEMENTATTRIBUTE2') AS ShipToCustAddrElementAtt2,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRELEMENTATTRIBUTE3') AS ShipToCustAddrElementAtt3,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRELEMENTATTRIBUTE4') AS ShipToCustAddrElementAtt4,
PO_BIP_HELPER.get_global_attr('SHIPTOCUSTADDRELEMENTATTRIBUTE5') AS ShipToCustAddrElementAtt5,
PO_BIP_HELPER.get_global_attr('REQUESTEREMAIL') AS RequesterEmail,
PO_BIP_HELPER.get_global_attr('DELIVERTOCUSTCONTACTPHONENUMBER') AS HdrDeliverToCustPhoneNumber,
PO_BIP_HELPER.get_global_attr('DELIVERTOCUSTCONTACTPHONETYPE') AS HdrDeliverToCustPhoneType,
PO_BIP_HELPER.get_global_attr('DELIVERTOCUSTCONTACTPREFERREDCONTACTMETHOD') AS HdrDelivertoCustPrefMethod,
PO_BIP_HELPER.get_global_attr('DESTINATIONTYPECODE') AS HdrDestinationTypeCode,
PO_BIP_HELPER.get_global_attr('ISREQUESTERMULTIPLE') AS IsRequesterMultiple,
PO_BIP_HELPER.set_attachment_content(:param_text_attachment) As AttachmentData,
PO_BIP_HELPER.get_text_attachment_data(Header.PO_HEADER_ID,'PO','HEADER') AS TextAttachmentsContent,
PO_BIP_HELPER.get_attachments_data_header(Header.PO_HEADER_ID,Version.VERSION_ID,PozSupplierSite.VENDOR_SITE_ID) As Attachments,
PO_BIP_HELPER.is_ship_to_loc_multiple(Header.PO_HEADER_ID,'DRAFT',0) As IsShipToLocationMultiple,
PO_BIP_HELPER.is_ship_to_cust_multiple(Header.PO_HEADER_ID,'DRAFT',0) As IsShipToCustomerMultiple,
PO_BIP_HELPER.is_ship_to_cust_loc_multiple(Header.PO_HEADER_ID,'DRAFT',0) As IsShipToCustLocMultiple,
PO_BIP_HELPER.is_ship_to_cust_con_multiple(Header.PO_HEADER_ID,'DRAFT',0) As IsShipToCustConMultiple,
PO_BIP_HELPER.is_del_to_cust_con_multiple(Header.PO_HEADER_ID,'DRAFT',0) As IsDelToCustConMultiple,
PO_BIP_HELPER.is_dest_type_drop_ship(Header.PO_HEADER_ID,'DRAFT',0) As IsDestTypeDropShip,
PO_BIP_HELPER.drop_ship_sched_exists(Header.PO_HEADER_ID,'DRAFT',0) As DropShipSchedExists,
PO_BIP_HELPER.get_global_attr('ISBIPCLIENTENABLED') AS IsBipClientEnabled,
PurchasingDocumentStyleHeade1.RETAINAGE_FLAG AS "IsRetainageFlagEnabled",
PurchasingDocumentStyleHeade1.PROGRESS_PAYMENT_FLAG AS "IsProgressPaymentFlagEnabled"
FROM PO_HEADERS_DRAFT_ALL Header, FND_LOOKUPS FreightTermsPoLookupPEO, FND_LOOKUPS FobPoLookupPEO, PO_DOC_STYLE_LINES_VL DocStyle, PO_VERSIONS Version, PON_BIDDING_TERMS_VL NegotiationTerms, POZ_SUPPLIERS Supplier, POZ_SUPPLIER_SITES_ALL_M PozSupplierSite, POZ_SUPPLIER_CONTACTS SupplierContact, WSH_CARRIERS Carrier, HR_LOCATIONS_ALL_F_VL ShipToLoc, HR_LOCATIONS_ALL_F_VL BillToLoc, HR_LOCATIONS_ALL_F_VL ProcBuLocation, HR_ORGANIZATION_V ProcurementBu, AP_TERMS_VL PaymentTermsHeader, HZ_PARTIES SupplierPartyName, HZ_PARTIES SupplierContactPartyName, HZ_PARTIES CarrierPartyName, PER_PERSON_NAMES_F_V PersonName, PER_DISPLAY_PHONES_V PersonPhone, PER_DISPLAY_PHONES_V PersonFaxPhone, PER_EMAIL_ADDRESSES PersonEmailAddress, FND_CURRENCIES_VL Currency, HZ_LOCATIONS SupplierLocation, PO_VERSIONS FirstVersion, PO_DOC_STYLE_HEADERS PurchasingDocumentStyleHeade1, HR_ORGANIZATION_V BillToBu, XLE_ENTITY_PROFILES SoldToLe, XLE_REGISTRATIONS SoldToLeRegistration, FND_LOOKUPS ModeOfTransportLookupPEO, FND_LOOKUPS ServiceLevelLookupPEO, HZ_LOCATIONS SoldToLeLocation, PO_SYSTEM_PARAMETERS_ALL PurchasingSystemParameterPEO, HZ_ADDTNL_PARTY_NAMES AdditionalPartyNamePEO, ZX_PARTY_TAX_PROFILE TAX_PRF,ZX_REGISTRATIONS ZXR
WHERE (Header.PRC_BU_ID = ProcurementBu.ORGANIZATION_ID(+) and trunc(sysdate) BETWEEN ProcurementBu.EFFECTIVE_START_DATE(+) AND ProcurementBu.EFFECTIVE_END_DATE(+) AND ProcurementBu.CLASSIFICATION_CODE (+) = 'FUN_BUSINESS_UNIT') and (PurchasingSystemParameterPEO.PRC_BU_ID = ProcurementBu.ORGANIZATION_ID) 
AND (Header.BILLTO_BU_ID = BillToBu.ORGANIZATION_ID(+)  AND trunc(sysdate) BETWEEN BillToBu.EFFECTIVE_START_DATE(+) AND BillToBu.EFFECTIVE_END_DATE(+) AND BillToBu.CLASSIFICATION_CODE (+) = 'FUN_BUSINESS_UNIT')
and (Header.SOLDTO_LE_ID = SoldToLe.LEGAL_ENTITY_ID)
AND (SoldToLe.LEGAL_ENTITY_ID = SoldToLeRegistration.SOURCE_ID)
AND (SoldToLeRegistration.SOURCE_TABLE = 'XLE_ENTITY_PROFILES')
AND (SoldToLeRegistration.IDENTIFYING_FLAG = 'Y')
AND (SoldToLeRegistration.LOCATION_ID = SoldToLeLocation.LOCATION_ID)
AND (SoldToLeLocation.INTERNAL_FLAG='Y')
AND (Header.AGENT_ID = PersonName.PERSON_ID(+)  AND trunc(sysdate) BETWEEN PersonName.EFFECTIVE_START_DATE(+) AND PersonName.EFFECTIVE_END_DATE(+))
AND (Header.SHIP_TO_LOCATION_ID = ShipToLoc.LOCATION_ID(+)  AND trunc(sysdate) BETWEEN ShipToLoc.EFFECTIVE_START_DATE(+) AND ShipToLoc.EFFECTIVE_END_DATE(+))    
AND (Header.BILL_TO_LOCATION_ID = BillToLoc.LOCATION_ID(+)  AND trunc(sysdate) BETWEEN BillToLoc.EFFECTIVE_START_DATE(+) AND BillToLoc.EFFECTIVE_END_DATE(+)) 
AND (Header.VENDOR_ID = Supplier.VENDOR_ID(+) AND Supplier.PARTY_ID = SupplierPartyName.PARTY_ID(+))
AND (Header.VENDOR_SITE_ID = PozSupplierSite.VENDOR_SITE_ID(+) AND Header.VENDOR_CONTACT_ID = SupplierContact.VENDOR_CONTACT_ID(+))
AND (SupplierContact.PER_PARTY_ID = SupplierContactPartyName.PARTY_ID(+))
AND (Header.TERMS_ID = PaymentTermsHeader.TERM_ID(+))
AND (Header.CARRIER_ID = Carrier.CARRIER_ID(+) AND Carrier.CARRIER_ID = CarrierPartyName.PARTY_ID(+))  
AND (Header.MODE_OF_TRANSPORT = ModeOftransportLookupPEO.lookup_code(+) AND ModeOftransportLookupPEO.lookup_type(+) = 'WSH_MODE_OF_TRANSPORT')
AND (Header.SERVICE_LEVEL = ServiceLevelLookupPEO.lookup_code(+) AND ServiceLevelLookupPEO.lookup_type(+) = 'WSH_SERVICE_LEVELS')
AND (Header.freight_terms_lookup_code = FreightTermsPoLookupPEO.lookup_code(+) AND  FreightTermsPoLookupPEO.lookup_type(+) = 'FREIGHT TERMS')
AND (Header.fob_lookup_code = FobPoLookupPEO.lookup_code(+) AND  FobPoLookupPEO.lookup_type(+) = 'FOB')
AND (Header.style_id = DocStyle.STYLE_ID (+) AND Header.TYPE_LOOKUP_CODE = DocStyle.DOCUMENT_SUBTYPE (+)) 
AND (Header.TYPE_LOOKUP_CODE = 'STANDARD')
AND (Header.AGENT_ID = PersonEmailAddress.PERSON_ID(+) AND PersonEmailAddress.EMAIL_TYPE(+) = 'W1' AND Header.AGENT_ID = PersonPhone.PERSON_ID(+) AND PersonPhone.PHONE_TYPE(+) ='W1')
AND (PersonPhone.DATE_FROM(+) <= TRUNC(SYSDATE) AND NVL(PersonPhone.DATE_TO,TRUNC(SYSDATE)) >= TRUNC(SYSDATE))
AND (Header.AGENT_ID = PersonFaxPhone.PERSON_ID(+) AND PersonFaxPhone.PHONE_TYPE(+) ='WF')
AND (PersonFaxPhone.DATE_FROM(+) <= TRUNC(SYSDATE) AND NVL(PersonFaxPhone.DATE_TO,TRUNC(SYSDATE)) >= TRUNC(SYSDATE))
AND (ProcurementBu.LOCATION_ID = ProcBuLocation.LOCATION_ID(+) AND trunc(sysdate) BETWEEN ProcBuLocation.EFFECTIVE_START_DATE(+) AND ProcBuLocation.EFFECTIVE_END_DATE(+))
AND (Header.PO_HEADER_ID = Version.PO_HEADER_ID)
AND (Header.PRC_BU_ID = NegotiationTerms.PRC_BU_ID(+) AND NegotiationTerms.APPLICATION_ID(+) = 201)
AND (Header.CURRENCY_CODE = Currency.CURRENCY_CODE(+))
AND (PozSupplierSite.LOCATION_ID = SupplierLocation.LOCATION_ID(+)) 
AND (Header.PO_HEADER_ID = FirstVersion.PO_HEADER_ID AND FirstVersion.CO_SEQUENCE = 0)
AND (PurchasingDocumentStyleHeade1.STYLE_ID(+) = Header.STYLE_ID)
----ACTUALIZACION AL 240123 - REGISTRATION NUMBER
AND (TAX_PRF.PARTY_ID(+) = Supplier.PARTY_ID)
AND (TAX_PRF.PARTY_TAX_PROFILE_ID = ZXR.PARTY_TAX_PROFILE_ID(+))
----
AND AdditionalPartyNamePEO.PARTY_NAME_TYPE(+) = 'PHONETIC'
AND AdditionalPartyNamePEO.status_flag(+) = 'A'
AND AdditionalPartyNamePEO.PARTY_ID(+) = Supplier.PARTY_ID and rownum = 1

ORDER BY NegotiationTerms.VERSION_NUM desc